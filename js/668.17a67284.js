"use strict";(self["webpackChunkchat_app_vue"]=self["webpackChunkchat_app_vue"]||[]).push([[668],{6668:function(s,e,t){t.r(e),t.d(e,{default:function(){return A}});var a=t(3396),o=t(7139),n=t(9242);const i={class:"chat_options_wrapper"},l={class:"chat_options"},r={class:"chat_wrapper"},h={key:0,class:"chat_handler"},c={key:1,class:"chat_content"},d=(0,a._)("i",{class:"fa-solid fa-paper-plane"},null,-1),u=[d];function g(s,e,t,d,g,p){const m=(0,a.up)("base-button"),w=(0,a.up)("base-dialog"),_=(0,a.up)("base-loader"),$=(0,a.up)("base-navbar"),v=(0,a.up)("message-list"),D=(0,a.up)("base-input");return(0,a.wg)(),(0,a.iD)(a.HY,null,[g.showDialog?((0,a.wg)(),(0,a.j4)(w,{key:0,onCloseDialog:e[0]||(e[0]=s=>g.showDialog=!1)},{default:(0,a.w5)((()=>[(0,a._)("div",i,[(0,a._)("h3",null,"Переписка с "+(0,o.zw)(this.$store.state.chat.currContactName),1),(0,a._)("div",l,[(0,a.Wm)(m,{class:"danger",onClick:p.removeChat},{default:(0,a.w5)((()=>[(0,a.Uk)("Убрать переписку")])),_:1},8,["onClick"])])])])),_:1})):(0,a.kq)("",!0),(0,a._)("div",r,[g.loading?((0,a.wg)(),(0,a.iD)("div",h,[(0,a.Wm)(_)])):((0,a.wg)(),(0,a.iD)("div",c,[(0,a._)("header",null,[(0,a.Wm)($,{onOpenOptions:e[1]||(e[1]=s=>g.showDialog=!0)})]),(0,a.Wm)(v,{messages:g.messages},null,8,["messages"]),(0,a._)("footer",null,[(0,a.Wm)(D,{class:"chat_input",onKeyup:(0,n.D2)(p.sendMessage,["enter"]),modelValue:g.text,"onUpdate:modelValue":e[2]||(e[2]=s=>g.text=s),placehldr:"Введите сообщение"},null,8,["onKeyup","modelValue"]),(0,a._)("div",{class:"send_button",onClick:e[3]||(e[3]=(...s)=>p.sendMessage&&p.sendMessage(...s))},u)])]))])],64)}t(7658);var p=t(7425),m=t(7732);const w=s=>((0,a.dD)("data-v-64743260"),s=s(),(0,a.Cn)(),s),_={class:"chat_header"},$={class:"header_start"},v=w((()=>(0,a._)("i",{class:"fa-solid fa-angle-left"},null,-1))),D=[v],k={class:"title"},C={class:"image_wrapper"},y=["src","alt"],f=w((()=>(0,a._)("i",{class:"fa-solid fa-ellipsis-vertical"},null,-1))),M=[f];function b(s,e,t,n,i,l){return(0,a.wg)(),(0,a.iD)("div",_,[(0,a._)("div",$,[(0,a._)("div",{class:"back_btn",onClick:e[0]||(e[0]=e=>s.$router.push("/"))},D),(0,a._)("div",k,[(0,a._)("div",C,[s.$store.state.chat.currContactPhoto?((0,a.wg)(),(0,a.iD)("img",{key:0,src:s.$store.state.chat.currContactPhoto,alt:t.name},null,8,y)):(0,a.kq)("",!0)]),(0,a._)("p",null,(0,o.zw)(s.$store.state.chat.currContactName),1)])]),(0,a._)("div",{class:"options",onClick:e[1]||(e[1]=e=>s.$emit("openOptions"))},M)])}var U={name:"BaseNavbar",props:["name","uid"]},I=t(89);const x=(0,I.Z)(U,[["render",b],["__scopeId","data-v-64743260"]]);var B=x;const O=s=>((0,a.dD)("data-v-663bb124"),s=s(),(0,a.Cn)(),s),E={class:"message_options_wrapper"},N=O((()=>(0,a._)("h3",null,"Ваше сообщение",-1))),T={class:"message_options"},W={key:1},V={key:2,class:"messages_handler"},j=O((()=>(0,a._)("br",null,null,-1))),K={class:"edit_message_wrapper"},L=O((()=>(0,a._)("h3",null,"Редактирование сообщения",-1)));function q(s,e,t,i,l,r){const h=(0,a.up)("base-button"),c=(0,a.up)("base-dialog"),d=(0,a.up)("base-message"),u=(0,a.up)("base-input");return(0,a.wg)(),(0,a.iD)(a.HY,null,[l.showDialog?((0,a.wg)(),(0,a.j4)(c,{key:0,onCloseDialog:e[0]||(e[0]=s=>l.showDialog=!1)},{default:(0,a.w5)((()=>[(0,a._)("div",E,[N,(0,a._)("div",T,[(0,a.Wm)(h,{class:"danger",onClick:r.deleteMessage},{default:(0,a.w5)((()=>[(0,a.Uk)("Удалить сообщение")])),_:1},8,["onClick"]),(0,a.Wm)(h,{onClick:r.showEditModal},{default:(0,a.w5)((()=>[(0,a.Uk)("Редактировать сообщение")])),_:1},8,["onClick"])])])])),_:1})):(0,a.kq)("",!0),t.messages.length?((0,a.wg)(),(0,a.iD)("main",W,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.messages,(s=>((0,a.wg)(),(0,a.j4)(d,{class:"message",key:s.timestamp,message:s,onOpenOptions:r.openOptions},null,8,["message","onOpenOptions"])))),128))])):((0,a.wg)(),(0,a.iD)("div",V,[(0,a._)("p",null,[(0,a.Uk)("Начните общение с "+(0,o.zw)(this.$store.state.chat.currContactName)+" c чего нибудь хорошего! 🤟",1),j,(0,a.Uk)(' Например, банальщины: спросите - "Как у тебя дела?"')])])),l.showEditDialog?((0,a.wg)(),(0,a.j4)(c,{key:3,onKeyup:(0,n.D2)(r.editMessage,["enter"]),onCloseDialog:e[2]||(e[2]=s=>l.showEditDialog=!1)},{default:(0,a.w5)((()=>[(0,a._)("div",K,[L,(0,a.Wm)(u,{modelValue:l.newText,"onUpdate:modelValue":e[1]||(e[1]=s=>l.newText=s)},null,8,["modelValue"]),(0,a.Wm)(h,{onClick:r.editMessage},{default:(0,a.w5)((()=>[(0,a.Uk)("Сохранить")])),_:1},8,["onClick"])])])),_:1},8,["onKeyup"])):(0,a.kq)("",!0)],64)}var P=t(3187),Z={components:{BaseButton:P.Z},name:"MessageList",props:["messages"],data(){return{showDialog:!1,showEditDialog:!1,newText:"",chosenMessage:{}}},mounted(){this.scrollDown()},methods:{scrollDown(){setTimeout((()=>{const s=document.getElementsByClassName("message"),e=s[s.length-1];e?.scrollIntoView({behavior:"smooth"})}),0)},openOptions(s){this.chosenMessage=s,this.showDialog=!0},async deleteMessage(){await this.$store.dispatch("deleteMessage",this.chosenMessage.messageId),this.showDialog=!1},showEditModal(){this.showEditDialog=!0},async editMessage(){this.newText&&(await this.$store.dispatch("updateMessage",{messageId:this.chosenMessage.messageId,newText:this.newText}),this.showEditDialog=!1,this.showDialog=!1,this.newText="")}},watch:{messages(){this.scrollDown()}}};const z=(0,I.Z)(Z,[["render",q],["__scopeId","data-v-663bb124"]]);var F=z,H={data(){return{loading:!0,text:"",messages:[],showDialog:!1,unsubFunc:null}},async mounted(){this.loading=!0;const s=await this.$store.dispatch("getUserInfo",this.$route.params.id),e=s.name,t=s.photoUrl;this.$store.commit("setCurrChat",this.$route.params.id),this.$store.commit("setCurrContactName",e),this.$store.commit("setCurrContactPhoto",t),this.dropUnreadMessages(this.$route.params.id),this.setMessagesListener()},unmounted(){this.unsubFunc()},methods:{async setMessagesListener(){this.loading=!0;const s=this.$store.state.auth.userInfo.uid,e=this.$store.state.chat.currChat,t=(0,p.hJ)(m.h,`users/${s}/chats/${e}/messages`),a=await(0,p.IO)(t,(0,p.Xo)("createdAt"));let o=[];this.unsubFunc=(0,p.cf)(a,(async t=>{e===this.$route.params.id&&(o=[],t.forEach((t=>{const a=t.data(),n={...a,date:a.date.toDate(),sendedBy:a.sendedBy,type:a.sendedBy===s?"outcoming":"incoming",photoUrl:a.sendedBy===s?this.$store.state.auth.userInfo.photoUrl:this.$store.state.chat.currContactPhoto};setTimeout((()=>{"incoming"===n.type&&"sended"==n.status&&this.updateMessageStatus(s,e,t.id)}),0),o.push(n)})),this.messages=o,await this.dropUnreadMessages(e),this.loading=!1)}))},async updateMessageStatus(s,e,t){const a=(0,p.JU)(m.h,`users/${e}/chats/${s}/messages`,`${t}`);await(0,p.r7)(a,{status:"checked"})},async sendMessage(){if(!this.text)return;const s=this.$store.state.auth.userInfo.uid,e=this.$store.state.auth.userInfo.name,t={text:this.text,date:new Date,createdAt:(0,p.Bt)(),status:"sending",sendedBy:s,name:e,type:"outcoming",photoUrl:this.$store.state.auth.userInfo.photoUrl?this.$store.state.auth.userInfo.photoUrl:"",messageId:Math.random()};this.text="",this.messages.push(t),await this.$store.dispatch("sendMessage",{messageObject:t,to:this.$route.params.id,hostName:this.$store.state.chat.currContactName})},async dropUnreadMessages(s){try{await this.$store.dispatch("dropUnreadMessages",s)}catch(e){console.log(e)}},async removeChat(){await this.$store.dispatch("removeChat"),this.showDialog=!1,this.$router.push("/")}},watch:{async $route(){await this.setMessagesListener()},async messages(){await this.dropUnreadMessages(this.$route.params.id)}},components:{BaseNavbar:B,MessageList:F}};const Y=(0,I.Z)(H,[["render",g]]);var A=Y}}]);
//# sourceMappingURL=668.17a67284.js.map